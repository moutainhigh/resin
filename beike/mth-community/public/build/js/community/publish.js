"use strict";function setLocation(t){"string"==typeof t&&(t=JSON.parse(t)),vm.publishFormData.location=(t.city||"")+(t.district||"")+(t.streetName||""),vm.publishFormData.latitude=t.latitude,vm.publishFormData.longitude=t.longitude}function handleCover(t){"string"==typeof t&&(t=JSON.parse(t)),vm.publishFormData.cover_path=t.doc_path}function handleIllustration(t){"string"==typeof t&&(t=JSON.parse(t)),document.getElementById("content").innerHTML+='<div class="illustration-wrap"><img src="'+t.doc_path+'" /></div><br>'}var vm=new Vue({el:"#publish",data:function(){return{publishFormData:{theme_type:"share",member_id:_mi,title:"",content:"",cover_path:"",location:"",latitude:"",longitude:"",work_circle:!1,life_circle:!1,home_circle:!1,hobby_circle:!1}}},methods:{getLocation:function(){M.iOSBridge?M.iOSBridge.callHandler("getLocation",function(t){setLocation(t)}):window.jsObj.getLocation("setLocation")},uploadImg:function(t){if(M.iOSBridge)t?M.iOSBridge.callHandler("uploadImg",function(t){handleCover(t)}):M.iOSBridge.callHandler("uploadImg",function(t){handleIllustration(t)});else{var e=t?"handleCover":"handleIllustration";window.jsObj.uploadImg(e)}},closeViewAndRefreshArticleList:function(){M.iOSBridge?M.iOSBridge.callHandler("closeAndRefresh"):window.jsObj.closeAndRefresh()},publish:function(){var t=this;return t.publishFormData.cover_path?t.publishFormData.work_circle||t.publishFormData.life_circle||t.publishFormData.home_circle||t.publishFormData.hobby_circle?(t.publishFormData.content=document.getElementById("content").innerHTML,void fetch("/addArticle",{credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},method:"post",body:JSON.stringify(t.publishFormData)}).then(function(e){e.ok&&e.json().then(function(e){"succ"==e.rsp_code?t.closeViewAndRefreshArticleList():M.Tip.danger("发布失败，请稍后重试！")})}).catch(function(t){M.Tip.danger("系统繁忙！")})):void M.Tip.info("请选择要发布的圈子！"):void M.Tip.info("请添加封面")}},mounted:function(){var t=this;setTimeout(function(){t.getLocation()},1e3)}});